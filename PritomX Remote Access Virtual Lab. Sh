#!/data/data/com.termux/files/usr/bin/bash
# PritomX Remote Access V1
# Cloudflared + SSH + Background Auto + Passwordless Login

echo "Updating Termux..."
pkg update -y && pkg upgrade -y

echo "Installing dependencies..."
pkg install -y openssh wget proot curl

echo "Downloading Cloudflared (ARM)..."
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-arm -O cloudflared
chmod +x cloudflared
mv cloudflared $PREFIX/bin/

echo "Setting up SSH Server..."
sshd

echo "Generating SSH Key..."
if [ ! -f ~/.ssh/id_rsa ]; then
    mkdir -p ~/.ssh
    ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
fi

echo "Configuring Passwordless Login..."
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

echo "Setting SSH Password (backup access)..."
echo -e "pritomx\npritomx" | passwd

echo "Creating Auto-Start Script..."
cat > $PREFIX/bin/pritomx-remote <<EOF
#!/data/data/com.termux/files/usr/bin/bash
sshd
cloudflared tunnel --url ssh://localhost:8022 --logfile /dev/null &
EOF

chmod +x $PREFIX/bin/pritomx-remote

echo "Running Remote Access Service..."
pritomx-remote

echo "=========== DONE ==========="
echo "PritomX Remote Access V1 Installed âœ”"
echo "Now copy your SSH key from: ~/.ssh/id_rsa"
